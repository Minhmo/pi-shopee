<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopee PTM - Mua b·∫±ng Pi</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { margin:0; font-family: 'Segoe UI',sans-serif; background:#f5f5f5; color:#333; }
    header {
      background:#ee4d2d; color:#fff; padding:12px 16px; display:flex; justify-content:space-between; align-items:center;
      position:sticky; top:0; z-index:1000; box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    .logo { font-size:22px; font-weight:bold; }
    .menu-icon { font-size:30px; cursor:pointer; }
    
    .nav-menu {
      position:fixed; top:0; left:-100%; width:75%; height:100%; background:#fff; transition:left .3s; z-index:999;
      box-shadow:2px 0 10px rgba(0,0,0,0.2);
    }
    .nav-menu.show { left:0; }
    .nav-menu .top { padding:20px; background:#ee4d2d; color:#fff; font-weight:bold; font-size:18px; }
    .nav-menu a { display:block; padding:16px 20px; color:#333; text-decoration:none; border-bottom:1px solid #eee; font-size:16px; }

    .user-info {
      background:#fff; margin:12px; padding:16px; border-radius:8px; border-left:5px solid #ee4d2d;
      text-align:center; font-size:15px; box-shadow:0 2px 6px rgba(0,0,0,0.08); cursor:pointer;
    }
    .product-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(175px,1fr)); gap:12px; padding:12px; }
    .product-card {
      background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 3px 10px rgba(0,0,0,0.1); transition:.2s;
    }
    .product-card:hover { transform:translateY(-4px); }
    .product-card img { width:100%; height:180px; object-fit:cover; }
    .product-info { padding:12px; }
    .product-title { font-size:15px; height:42px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
    .product-price { color:#ee4d2d; font-weight:bold; font-size:17px; margin:6px 0; }
    
    .buy-btn, .pay-pi-btn {
      display:block; width:100%; padding:11px; color:#fff; text-align:center; border-radius:6px;
      font-weight:bold; margin-top:8px; cursor:pointer; border:none; font-size:14px;
    }
    .buy-btn { background:#ee4d2d; }
    .pay-pi-btn { background:linear-gradient(135deg,#673ab7,#9c27b0); }

    .chat-btn {
      position:fixed; bottom:24px; right:24px; background:#25d366; color:#fff; width:60px; height:60px;
      border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px;
      box-shadow:0 4px 12px rgba(0,0,0,0.25); z-index:1000; text-decoration:none;
    }
  </style>
</head>
<body>

  <header>
    <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>
    <div class="logo">SHOPEE PTM</div>
    <div style="font-size:24px;">üõí</div>
  </header>

  <!-- Menu -->
  <nav class="nav-menu" id="navMenu">
    <div class="top">DANH M·ª§C</div>
    <a href="#" onclick="toggleMenu()">üè† Trang ch·ªß</a>
    <a href="#" onclick="shareApp();toggleMenu()">üì§ Chia s·∫ª App</a>
    <a href="#" onclick="toggleMenu()">üí¨ Li√™n h·ªá h·ªó tr·ª£</a>
  </nav>

  <!-- User Info -->
  <div class="user-info" id="user-display" onclick="tryAuthenticate()">
    ƒêang k·∫øt n·ªëi Pi Network... (click ƒë·ªÉ retry)
  </div>

  <!-- Products -->
  <div class="product-grid">
    <div class="product-card">
      <img src="https://via.placeholder.com/300x300/ee4d2d/ffffff?text=√Åo+Thun+Nam" alt="√Åo thun">
      <div class="product-info">
        <div class="product-title">√Åo thun nam Shopee Style</div>
        <div class="product-price">99.000ƒë</div>
        <a class="buy-btn" href="https://collshp.com/mediaplusptm13968?view=storefront" target="_blank">XEM TR√äN SHOPEE</a>
        <button class="pay-pi-btn" onclick="buyWithPi('√Åo thun nam Shopee Style', 1)">MUA B·∫∞NG PI (1 Pi)</button>
      </div>
    </div>

    <div class="product-card">
      <img src="https://via.placeholder.com/300x300/673ab7/ffffff?text=Gi√†y+Sneaker" alt="Gi√†y sneaker">
      <div class="product-info">
        <div class="product-title">Gi√†y Sneaker m·∫´u m·ªõi c·ª±c ch·∫•t</div>
        <div class="product-price">299.000ƒë</div>
        <a class="buy-btn" href="https://collshp.com/mediaplusptm13968?view=storefront" target="_blank">XEM TR√äN SHOPEE</a>
        <button class="pay-pi-btn" onclick="buyWithPi('Gi√†y Sneaker m·∫´u m·ªõi', 3)">MUA B·∫∞NG PI (3 Pi)</button>
      </div>
    </div>
  </div>

  <a href="https://wa.me/84974457838" class="chat-btn" target="_blank">üí¨</a>

  <script>
    // Kh·ªüi t·∫°o SDK
    if (window.Pi) Pi.init({ version: "2.0", sandbox: true });

    function toggleMenu() {
      document.getElementById('navMenu').classList.toggle('show');
    }

    let authAttempted = false;

    function tryAuthenticate() {
      if (authAttempted) return;
      authAttempted = true;
      const display = document.getElementById('user-display');
      display.innerHTML = "ƒêang th·ª≠ k·∫øt n·ªëi Pi...";

      Pi.authenticate(["username", "payments"], (p) => console.log("Incomplete payment:", p))
        .then(auth => {
          display.innerHTML = Ch√†o <b>${auth.user.username}</b>!<br>K·∫øt n·ªëi Pi th√†nh c√¥ng ‚úì;
          alert(‚úÖ K·∫øt n·ªëi Pi th√†nh c√¥ng!\n\nUsername: ${auth.user.username}\n\nB√¢y gi·ªù b·∫°n c√≥ th·ªÉ mua b·∫±ng Pi.);
        })
        .catch(err => {
          console.error(err);
          display.innerHTML = "L·ªói k·∫øt n·ªëi Pi.<br>Click l·∫°i ƒë·ªÉ th·ª≠ (ho·∫∑c authorize sandbox)";
          alert("‚ùå L·ªói authenticate: " + (err?.message || "H√£y authorize sandbox r·ªìi th·ª≠ l·∫°i!"));
          authAttempted = false; // cho ph√©p retry
        });
    }

    // T·ª± ƒë·ªông th·ª≠ sau 3 gi√¢y
    setTimeout(tryAuthenticate, 3000);

    function buyWithPi(productName, amount) {
      if (!Pi || !Pi.authenticated) {
        alert("Ch∆∞a k·∫øt n·ªëi Pi th√†nh c√¥ng!\n\nVui l√≤ng ch·ªù th√¥ng b√°o xanh ho·∫∑c click retry ·ªü tr√™n.");
        return;
      }

      const paymentData = {
        amount: amount,
        memo: Mua ${productName} tr√™n Shopee PTM,
        metadata: { product: productName, orderId: PTM-${Date.now()} }
      };

      const callbacks = {
        onReadyForServerApproval: (paymentId) => {
          alert(‚úÖ Payment ID: ${paymentId}\n\nƒêang ch·ªù server approve (Sandbox));
        },
        onReadyForServerCompletion: (paymentId, txid) => {
          alertüéâ THANH TO√ÅN TH√ÄNH C√îNG!\n\nS·∫£n ph·∫©m: ${productName}\nS·ªë Pi: ${amount}\nTxID: ${txid}`);
        },
        onCancel: () => alert("B·∫°n ƒë√£ h·ªßy thanh to√°n."),
        onError: (error) => alert("L·ªói thanh to√°n: " + (error?.message || "Vui l√≤ng th·ª≠ l·∫°i"))
      };

      Pi.createPayment(paymentData, callbacks);
    }

    function shareApp() {
      if (window.Pi) {
        Pi.openShareDialog({
          title: "Shopee PTM - Mua b·∫±ng Pi",
          content: "App affiliate Shopee + thanh to√°n Pi si√™u nhanh! Truy c·∫≠p ngay: https://pi-shopee.vercel.app"
        });
      }
    }

    console.log("%cüöÄ Shopee PTM - Optimized & Ready for Testnet", "color:#ee4d2d;font-weight:bold;font-size:14px");
  </script>
</body>
</html>
