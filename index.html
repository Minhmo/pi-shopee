<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee Pi - Buoc 10</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body style="text-align: center; padding: 20px; font-family: sans-serif;">

    <h2 style="color: #ee4d2d;">SHOPEE PTM</h2>
    
    <p id="status" style="color: gray;">Đang kết nối ví Pi...</p>

    <button id="buyBtn" onclick="pay()" style="
        background: #ee4d2d; color: white; 
        padding: 15px 30px; font-size: 18px; 
        border: none; border-radius: 8px; display: none;">
        MUA NGAY (1 PI)
    </button>

    <script>
        const Pi = window.Pi;
        Pi.init({ version: "2.0", sandbox: true });

        // 1. Đăng nhập
        Pi.authenticate(['username', 'payments'], {
            onIncompletePaymentFound: function(payment) { console.log(payment); }
        }).then(function(auth) {
            // Đăng nhập thành công -> Hiện tên và Nút mua
            document.getElementById('status').innerHTML = "Chào mừng: <b>" + auth.user.username + "</b>";
            document.getElementById('status').style.color = "green";
            document.getElementById('buyBtn').style.display = "inline-block";
        }).catch(function(error) {
            document.getElementById('status').innerHTML = "Lỗi: " + error;
        });

        // 2. Hàm thanh toán
        function pay() {
            Pi.createPayment({
                amount: 1,
                memo: "Demo Step 10",
                metadata: { orderId: 12345 }
            }, {
                onReadyForServerApproval: function(paymentId) {
                    alert("Đã gửi đơn! PaymentID: " + paymentId);
                },
                onReadyForServerCompletion: function(paymentId, txid) {
                    alert("THÀNH CÔNG! TxID: " + txid);
                },
                onCancel: function(paymentId) { alert("Đã hủy"); },
                onError: function(error, payment) { alert("Lỗi: " + error); }
            });
        }
    </script>
</body>
</html>
